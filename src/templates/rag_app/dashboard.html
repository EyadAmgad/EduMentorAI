{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - EduMentorAI{% endblock %}

{% block body_class %}dashboard-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}


{% block content %}
<!-- Hero Section -->
<section class="dashboard-hero">
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-greeting">Welcome back, {{ user.first_name|default:user.username }}!</h1>
            <p class="hero-subtitle">Ready to continue your learning journey? Here's what's happening with your progress.</p>

            <div class="hero-actions">
                <a href="{% url 'rag_app:document_upload' %}" class="btn-hero-action">
                    <i class="fas fa-plus me-2"></i>Upload Document
                </a>
                <a href="{% url 'rag_app:chat' %}" class="btn-hero-action">
                    <i class="fas fa-comments me-2"></i>Start Chat
                </a>
                <a href="{% url 'rag_app:generate_rag_quiz' %}" class="btn-hero-action">
                    <i class="fas fa-question me-2"></i>Generate Quiz
                </a>
            </div>
        </div>
    </div>
</section>

<div class="container">
    <!-- Stats Grid -->
    <div class="stats-grid">
        <div class="stat-card-revolutionary">
            <div class="stat-icon" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white;">
                <i class="fas fa-book"></i>
            </div>
            <span class="stat-number">{{ total_subjects }}</span>
            <div class="stat-label">Total Subjects</div>
            <div class="stat-description">Subjects you're currently studying</div>
        </div>

        <div class="stat-card-revolutionary">
            <div class="stat-icon" style="background: linear-gradient(135deg, var(--success-color), #047857); color: white;">
                <i class="fas fa-file-alt"></i>
            </div>
            <span class="stat-number">{{ total_documents }}</span>
            <div class="stat-label">Documents Uploaded</div>
            <div class="stat-description">Study materials in your library</div>
        </div>

        <div class="stat-card-revolutionary">
            <div class="stat-icon" style="background: linear-gradient(135deg, var(--warning-color), #b45309); color: white;">
                <i class="fas fa-question-circle"></i>
            </div>
            <span class="stat-number">{{ total_quizzes }}</span>
            <div class="stat-label">Quizzes Created</div>
            <div class="stat-description">Tests to challenge your knowledge</div>
        </div>

        <div class="stat-card-revolutionary">
            <div class="stat-icon" style="background: linear-gradient(135deg, var(--info-color), #5b21b6); color: white;">
                <i class="fas fa-chart-line"></i>
            </div>
            <span class="stat-number">{{ average_quiz_score|floatformat:0 }}%</span>
            <div class="stat-label">Average Score</div>
            <div class="stat-description">Your overall performance</div>
        </div>
    </div>

    <!-- Main Dashboard Content -->
    <div class="dashboard-main">
        <!-- Activity Section -->
        <div class="activity-section">
            <div class="activity-header">
                <h2 class="activity-title">
                    <i class="fas fa-clock"></i>
                    Recent Activity
                </h2>
                <div class="activity-tabs">
                    <button class="activity-tab active" onclick="showActivityTab('documents')">
                        <i class="fas fa-file-alt me-1"></i>Documents
                    </button>
                    <button class="activity-tab" onclick="showActivityTab('quizzes')">
                        <i class="fas fa-question-circle me-1"></i>Quizzes
                    </button>
                    <button class="activity-tab" onclick="showActivityTab('chats')">
                        <i class="fas fa-comments me-1"></i>Chats
                    </button>
                </div>
            </div>

            <div class="activity-content">
                <!-- Documents Tab -->
                <div id="documents-tab" class="activity-tab-content">
                    {% if recent_documents %}
                        {% for document in recent_documents %}
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white;">
                                <i class="fas fa-file{% if document.document_type == 'pdf' %}-pdf{% elif document.document_type == 'docx' %}-word{% elif document.document_type == 'pptx' %}-powerpoint{% endif %}"></i>
                            </div>
                            <div class="activity-info">
                                <h6>
                                    <a href="{% url 'rag_app:document_detail' document.pk %}" style="text-decoration: none; color: inherit;">
                                        {{ document.title }}
                                    </a>
                                </h6>
                                <div class="activity-meta">
                                    {{ document.subject.name }} • Uploaded {{ document.uploaded_at|timesince }} ago
                                </div>
                            </div>
                            <div class="activity-status">
                                {% if document.processed %}
                                    <span class="status-badge status-success">Processed</span>
                                {% else %}
                                    <span class="status-badge status-warning">Processing</span>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="empty-title">No documents yet</div>
                            <div class="empty-description">Upload your first document to get started with your learning journey.</div>
                            <a href="{% url 'rag_app:document_upload' %}" class="btn btn-hero-action">
                                <i class="fas fa-plus me-2"></i>Upload Document
                            </a>
                        </div>
                    {% endif %}
                </div>

                <!-- Quizzes Tab -->
                <div id="quizzes-tab" class="activity-tab-content" style="display: none;">
                    {% if recent_quizzes %}
                        {% for quiz in recent_quizzes %}
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, var(--warning-color), #b45309); color: white;">
                                <i class="fas fa-question"></i>
                            </div>
                            <div class="activity-info">
                                <h6>
                                    <a href="{% url 'rag_app:quiz_detail' quiz.pk %}" style="text-decoration: none; color: inherit;">
                                        {{ quiz.title }}
                                    </a>
                                </h6>
                                <div class="activity-meta">
                                    {{ quiz.subject.name }} • {{ quiz.total_questions }} questions • {{ quiz.time_limit }} min
                                </div>
                            </div>
                            <div class="activity-status">
                                <a href="{% url 'rag_app:quiz_take' quiz.pk %}" class="btn-hero-action" style="padding: 0.5rem 1rem; font-size: 0.85rem;">
                                    Take Quiz
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <div class="empty-title">No quizzes yet</div>
                            <div class="empty-description">Generate your first quiz to test your knowledge and track progress.</div>
                            <a href="{% url 'rag_app:generate_rag_quiz' %}" class="btn btn-hero-action">
                                <i class="fas fa-magic me-2"></i>Generate Quiz
                            </a>
                        </div>
                    {% endif %}
                </div>

                <!-- Chats Tab -->
                <div id="chats-tab" class="activity-tab-content" style="display: none;">
                    {% if recent_chat_sessions %}
                        {% for session in recent_chat_sessions %}
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, var(--info-color), #5b21b6); color: white;">
                                <i class="fas fa-comment"></i>
                            </div>
                            <div class="activity-info">
                                <h6>
                                    <a href="{% url 'rag_app:chat_session' session.pk %}" style="text-decoration: none; color: inherit;">
                                        {{ session.title|default:"Chat Session" }}
                                    </a>
                                </h6>
                                <div class="activity-meta">
                                    {% if session.subject %}{{ session.subject.name }} • {% endif %}
                                    Last activity {{ session.last_activity|timesince }} ago
                                </div>
                            </div>
                            <div class="activity-status">
                                <span class="status-badge status-primary">{{ session.messages.count }} messages</span>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="empty-title">No chat sessions yet</div>
                            <div class="empty-description">Start chatting with AI to get instant help with your studies.</div>
                            <a href="{% url 'rag_app:chat' %}" class="btn btn-hero-action">
                                <i class="fas fa-comments me-2"></i>Start Chat
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Quick Actions Section -->
        <div class="quick-actions">
            <h3>Quick Actions</h3>
            <p>Jump into your most common tasks with these shortcuts</p>

            <div class="quick-actions-grid">
                <a href="{% url 'rag_app:document_upload' %}" class="quick-action-card">
                    <div class="quick-action-icon">
                        <i class="fas fa-upload"></i>
                    </div>
                    <div class="quick-action-title">Upload Document</div>
                    <div class="quick-action-description">Add new study materials to your library</div>
                </a>

                <a href="{% url 'rag_app:generate_rag_quiz' %}" class="quick-action-card">
                    <div class="quick-action-icon">
                        <i class="fas fa-magic"></i>
                    </div>
                    <div class="quick-action-title">Generate Quiz</div>
                    <div class="quick-action-description">Create AI-powered quizzes from your documents</div>
                </a>

                <a href="{% url 'rag_app:chat' %}" class="quick-action-card">
                    <div class="quick-action-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="quick-action-title">Start Chat</div>
                    <div class="quick-action-description">Get instant help with your studies</div>
                </a>

                <a href="{% url 'rag_app:subject_create' %}" class="quick-action-card">
                    <div class="quick-action-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <div class="quick-action-title">Create Subject</div>
                    <div class="quick-action-description">Organize your study materials</div>
                </a>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="dashboard-sidebar">
            <!-- Quick Actions -->
            <div class="sidebar-card">
                <div class="sidebar-header">
                    <h3 class="sidebar-title">
                        <i class="fas fa-bolt"></i>
                        Quick Actions
                    </h3>
                </div>
                <div class="sidebar-content">
                    <a href="{% url 'rag_app:subject_create' %}" class="action-button">
                        <div class="action-icon" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white;">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <div class="action-info">
                            <h6>Create New Subject</h6>
                            <small>Organize your study materials</small>
                        </div>
                    </a>

                    <a href="{% url 'rag_app:document_upload' %}" class="action-button">
                        <div class="action-icon" style="background: linear-gradient(135deg, var(--success-color), #047857); color: white;">
                            <i class="fas fa-upload"></i>
                        </div>
                        <div class="action-info">
                            <h6>Upload Document</h6>
                            <small>Add study materials</small>
                        </div>
                    </a>

                    <a href="{% url 'rag_app:generate_rag_quiz' %}" class="action-button">
                        <div class="action-icon" style="background: linear-gradient(135deg, var(--warning-color), #b45309); color: white;">
                            <i class="fas fa-magic"></i>
                        </div>
                        <div class="action-info">
                            <h6>Generate Quiz</h6>
                            <small>Create personalized tests</small>
                        </div>
                    </a>

                    <a href="{% url 'rag_app:slide_generate' %}" class="action-button">
                        <div class="action-icon" style="background: linear-gradient(135deg, var(--info-color), #5b21b6); color: white;">
                            <i class="fas fa-presentation"></i>
                        </div>
                        <div class="action-info">
                            <h6>Generate Slides</h6>
                            <small>Create presentations</small>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Recent Quiz Results -->
            <div class="sidebar-card">
                <div class="sidebar-header">
                    <h3 class="sidebar-title">
                        <i class="fas fa-chart-bar"></i>
                        Recent Quiz Results
                    </h3>
                </div>
                <div class="sidebar-content">
                    {% if quiz_attempts %}
                        {% for attempt in quiz_attempts %}
                        <div class="quiz-result-item">
                            <div class="quiz-info">
                                <h6>{{ attempt.quiz.title|truncatechars:30 }}</h6>
                                <div class="quiz-date">{{ attempt.completed_at|date:"M d, Y" }}</div>
                            </div>
                            <div class="quiz-score">{{ attempt.score|floatformat:0 }}%</div>
                        </div>
                        {% endfor %}
                        <div style="text-align: center; margin-top: 1rem;">
                            <a href="{% url 'rag_app:quiz_list' %}" class="btn-hero-action" style="padding: 0.5rem 1rem; font-size: 0.85rem;">
                                View All Results
                            </a>
                        </div>
                    {% else %}
                        <div class="empty-state" style="padding: 2rem 0;">
                            <div class="empty-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="empty-title">No quiz attempts yet</div>
                            <div class="empty-description">Take your first quiz to see results here.</div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}

